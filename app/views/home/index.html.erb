<!-- Header con título y botón -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0 fw-bold">MOSTRADOR</h1>
  <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#nuevoPedidoOffcanvas">
    + Nuevo Pedido
  </button>
</div>

<div class="row g-4">
  <!-- Columna Izquierda: Tablas de Pedidos -->
  <div class="col-lg-8">
    <!-- Tabla EN CURSO -->
    <div class="card mb-4">
      <div class="card-header bg-light">
        <h5 class="mb-0 fw-bold">EN CURSO</h5>
      </div>
      <div class="card-body p-0">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Hora Inicio</th>
              <th>Estado</th>
              <th>Cliente</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <% if @orders.present? %>
              <% @orders.each do |order| %>
                <tr>
                  <td><%= order.id %></td>
                  <td><%= order.created_at.strftime("%d/%m/%Y %H:%M:%S") %></td>
                  <td>
                    <% if order.status == 0 %>
                      <span class="bg-success text-white fw-bold p-1 rounded">En curso</span>
                    <% else %>
                      <span class="bg-danger text-white fw-bold p-1 rounded">Cerrada</span>
                    <% end %>
                  </td>
                  <td><%= order.cliente %></td>
                  <td><%= "0" %></td>
                </tr>
              <% end %>
            <% else %>
              <tr>
                <td colspan="5" class="text-center text-muted py-4">
                  Sin ventas en curso.
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Tabla CERRADAS -->
    <div class="card">
      <div class="card-header bg-light">
        <h5 class="mb-0 fw-bold">CERRADAS (ÚLTIMAS 5)</h5>
      </div>
      <div class="card-body p-0">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Hora Inicio</th>
              <th>Estado</th>
              <th>Cliente</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-start border-success border-3">
              <td class="fw-bold">2199</td>
              <td>18/01/26 22:30:45</td>
              <td><span class="text-success">Cerrada</span></td>
              <td></td>
              <td class="fw-bold">$24.500</td>
            </tr>
            <tr class="border-start border-success border-3">
              <td class="fw-bold">2198</td>
              <td>18/01/26 22:21:13</td>
              <td><span class="text-success">Cerrada</span></td>
              <td></td>
              <td class="fw-bold">$18.000</td>
            </tr>
            <tr class="border-start border-success border-3">
              <td class="fw-bold">2197</td>
              <td>18/01/26 22:13:34</td>
              <td><span class="text-success">Cerrada</span></td>
              <td></td>
              <td class="fw-bold">$23.000</td>
            </tr>
            <tr class="border-start border-success border-3">
              <td class="fw-bold">2196</td>
              <td>18/01/26 22:05:03</td>
              <td><span class="text-success">Cerrada</span></td>
              <td></td>
              <td class="fw-bold">$46.500</td>
            </tr>
            <tr class="border-start border-success border-3">
              <td class="fw-bold">2195</td>
              <td>18/01/26 21:55:52</td>
              <td><span class="text-success">Cerrada</span></td>
              <td></td>
              <td class="fw-bold">$17.500</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

<!-- Columna Derecha: Formulario NUEVO PEDIDO o Detalle de Pedido -->
<% if @new_order_id.present? && @current_order.present? %>
  <div class="col-lg-4">
    <div class="card border-0 shadow-sm">
      <!-- Header con ID y botones -->
      <div class="card-header bg-warning text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-bold">ID #<%= @current_order.id %></h5>
        <div>
          <button class="btn btn-sm btn-light me-2" type="button" title="Confirmar">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square" viewBox="0 0 16 16">
              <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
              <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
            </svg>
          </button>
          <button class="btn btn-sm btn-light" type="button" title="Editar">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
              <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 9.207 2.5 1.207l3.707 3.707L12.793 5.5z"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="card-body">
        <!-- Información del pedido -->
        <div class="mb-3">
          <div class="mb-2">
            <strong>Hora Inicio:</strong> <%= @current_order.created_at.strftime("%d/%m/%y %H:%M:%S") %>
          </div>
          <div>
            <strong>Seguimiento:</strong> 
            <a href="#" class="text-decoration-none">
              Ver pedido
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-up-right" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
                <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>
              </svg>
            </a>
          </div>
        </div>

        <!-- Sección ADICIONAR -->
        <div class="bg-secondary text-white p-2 mb-3 d-flex justify-content-between align-items-center">
          <span class="fw-bold">ADICIONAR</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.292-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.292c.415.764-.42 1.6-1.185 1.184l-.292-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.292A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z"/>
          </svg>
        </div>

        <!-- Búsqueda de productos -->
        <div class="mb-3 d-flex align-items-center">
          <button class="btn btn-warning text-white me-2" type="button" style="width: 40px; height: 40px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
              <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
            </svg>
          </button>
          <input type="text" class="form-control" placeholder="Buscar producto...">
        </div>

        <!-- Grid de productos (placeholder) -->
        <div class="row g-2 mb-3" style="max-height: 300px; overflow-y: auto;">
          <!-- Estos productos serían dinámicos desde la base de datos -->
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">Agua brisa 1.5</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">Coca cola 1.5</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">Coca cola mini</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">11 Coca Cola Person...</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">2 La Atrevida</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">1 La Humilde</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">5 La Prohibida</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">3 La Toxica</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">4 La Tragona</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">Naranja personal 400</button>
          </div>
          <div class="col-6">
            <button class="btn btn-light w-100 text-start" type="button">6 papas carne</button>
          </div>
        </div>
      </div>

      <!-- Footer con Total y botones -->
      <div class="card-footer bg-dark text-white p-2">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <span class="fw-bold">Total:</span>
          <span class="fw-bold">$0</span>
        </div>
        <div class="d-grid gap-2">
          <button class="btn btn-secondary" type="button" disabled>% Aplicar Descuento</button>
          <button class="btn btn-dark border" type="button">Cerrar Pedido</button>
        </div>
      </div>
    </div>
  </div>
<% else %>
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-warning text-white">
          <h5 class="mb-0 fw-bold">NUEVO PEDIDO</h5>
        </div>
        <div class="card-body">
          <% if notice %>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
              <%= notice %>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          <% end %>
          <% if alert %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <%= alert %>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          <% end %>
          
          <%= form_with url: orders_path, method: :post, local: true, data: { turbo: false }, class: "needs-validation", novalidate: true do |f| %>
            <div class="mb-3">
              <%= f.label :cliente, "Cliente", class: "form-label" %>
              <%= f.text_field :cliente, class: "form-control", placeholder: "Nombre del cliente", required: true %>
            </div>

            <div class="mb-3">
              <%= f.label :mesero, "Mesero", class: "form-label" %>
              <%= f.select :mesero, 
                  options_for_select([
                    ["Seleccionar mesero...", ""],
                    ["Mesero 1", "mesero1"],
                    ["Mesero 2", "mesero2"],
                    ["Mesero 3", "mesero3"]
                  ]), 
                  {}, 
                  { class: "form-select", required: true } %>
            </div>

            <div class="mb-3">
              <%= f.label :comentario, "Comentario", class: "form-label" %>
              <%= f.text_area :comentario, class: "form-control", rows: 4, placeholder: "Comentarios adicionales..." %>
            </div>

            <div class="d-grid">
              <%= f.submit "Crear", class: "btn btn-warning text-white fw-bold" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>
</div>
